<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accent</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Sans+Condensed:wght@500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fira Sans Condensed';
            font-weight: 500;
        }
        .main {
            width: 80%;
            margin: 0 auto 0 auto;
        }

        .viewer {
            margin-top: 1rem;
            font-size: 4rem;
            color: #ab58e2;
            text-align: center;
        }

        .charcont {
            margin-top: 5rem;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }

        .char {
            width: 10rem;
            height: 10rem;
            margin: 0 1rem 1rem 1rem;
            border-radius: 10px;
            background-color: #54dbf3;
            color: #ffffff;
            font-size: 5rem;
            text-transform: uppercase;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: 0.2s;
            cursor: pointer;
        }

        .button {
            margin: 8rem auto 0 auto;
            width: 30%;
            height: 8rem;
            text-align: center;
            color: #ffffff;
            background-color: #54f389;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 5rem;
            cursor: pointer;

        }

        .res {
            font-size: 4rem;
            color: #000;
            text-align: center;
            margin-top: 1rem;
        }

        .green {
            color: #54f389;
        }

        .red {
            color: #ed0f47;
        }

        .magenta {
            color: #ab58e2;
        }

        .retry {
            width: 6rem;
            height: 6rem;
            position: fixed;
            right: 7rem;
            bottom: 7rem;
            background-color: #54f389;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .retry div {
            width: 5rem;
            height: 5rem;
        }

        .retry div img {
            width: 100%;
        }

        .invisiable {
            display: none;
        }

        @media screen and (max-width: 750px) {
            .main {
                width: 100%;
            }

            .button {
                width: 90%;
            }

            .retry {
                right: 3rem;
                bottom: 3rem;
            }
        }

        @media screen and (max-width: 550px) {
            .char {
                width: 8rem;
                height: 8rem;
                font-size: 4rem;
                margin: 0 0.5rem 1rem 0.5rem;
            }

            .button {
                margin-top: 3rem;
            }

            .res {
                font-size: 3rem;
            }
        }

        @media screen and (max-width: 450px) {
            .char {
                width: 6rem;
                height: 6rem;
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <div class="main">
        <div class="viewer">0 of n</div>
        <div class="charcont">
            <div class="char"><div>a</div></div>
            <div class="char"><div>c</div></div>
            <div class="char"><div>b</div></div>
        </div>
        <div class="button invisiable"><div>OK</div></div>
        <div class="retry invisiable"><div><img src="./resources/arrow.svg" alt="retry"></div></div>
        <div class="rescont"></div>
    </div>
    <script>
        let s = "аэропОрты, им. п. мн. ч. сущ. аэропОрт, бАнты, им. п. мн. ч. сущ. бант, бОроду, вин. п. ед. ч. сущ. бородА, бухгАлтеров, род. п. мн. ч. сущ. бухгАлтер, вероисповЕдание1, водопровОд, газопровОд, граждАнство, дефИс, дешевИзна, диспансЕр, договорЁнность, докумЕнт, досУг, еретИк, жалюзИ, знАчимость, Иксы, им. п. мн. ч. сущ. икс, каталОг, квартАл (во всех значениях), киломЕтр, кОнусов, род. п. мн. ч. сущ. кОнус, корЫсть, крАны, им. п. мн. ч. сущ. кран, кремЕнь; кремнЯ, род. п. ед. ч., лЕкторов, род. п. мн. ч. сущ. лЕктор, лОктя, род. п. ед. ч. сущ. лОкоть; локтЕй, род. п. мн. ч., лыжнЯ, мЕстностей, род. п. мн. ч. сущ. мЕстность, намЕрение, нарОст, нЕдруг, недУг, некролОг, нЕнависть, нефтепровОд, новостЕй, род. п. мн. ч. сущ. нОвость, нОгтя, род. п. ед. ч. сущ. нОготь; ногтЕй, род. п. мн. ч., Отзыв (о книге), «отклик, мнение, рецензия», отзЫв (посла из страны), действие по глаг. отозвАть – «потребовать возвращения назад», Отрочество, партЕр, портфЕль, пОручни, придАное, призЫв, свЁкла, сирОты, им. п. мн. ч. сущ. сиротА, созЫв, сосредотОчение, срЕдства, им. п. мн. ч. сущ. срЕдство, стАтуя, столЯр, тамОжня, тОрты, им. п. мн. ч. сущ. торт, тУфля, цемЕнт, цЕнтнер, цепОчка, шАрфы, им. п. мн. ч. сущ. шарф, шофЁр, экспЕрт, бралА, прош. вр. ж. р. глаг. брАть, бралАсь, прош. вр. ж. р. глаг. брАться, взялА, прош. вр. ж. р. глаг. взЯть, взялАсь, прош. вр. ж. р. глаг. взЯться, влилАсь, прош. вр. ж. р. глаг. влИться, ворвалАсь, прош. вр. ж. р. глаг. ворвАться, воспринЯть; воспринялА, прош. вр. ж. р., воссоздалА, прош. вр. ж. р. глаг. воссоздАть, вручИт, 3-е л. ед. ч.2 глаг. вручИть, гналА, прош. вр. ж. р. глаг. гнАть, гналАсь, прош. вр. ж. р. глаг. гнАться, добралА, прош. вр. ж. р. глаг. добрАть, добралАсь, прош. вр. ж. р. глаг. добрАться, дождалАсь, прош. вр. ж. р. глаг. дождАться, дозвонИтся, 3-е л. ед. ч. глаг. дозвонИться, дозИровать, ждалА, прош. вр. ж. р. глаг. ждАть, жилОсь, прош. вр. ср. р. глаг. жИться, закУпорить, занЯть; зАнял, занялА, зАняли, прош. вр., заперлА, прош. вр. ж. р. глаг. заперЕть, запломбировАть, защемИт, 3-е л. ед. ч. глаг. защемИть, звалА, прош. вр. ж. р. глаг. звАть, звонИт, 3-е л. ед. ч. глаг. звонИть, кАшлянуть, клАла, прош. вр. ж. р. глаг. клАсть, клЕить, крАлась, прош. вр. ж. р. глаг. крАсться, кровоточИть, лгалА, прош. вр. ж. р. глаг. лгАть, лилА, прош. вр. ж. р. глаг. лИть, лилАсь, прош. вр. ж. р. глаг. лИться, навралА, прош. вр. ж. р. глаг. наврАть, наделИт, 3-е л. ед. ч. глаг. наделИть, надорвалАсь, прош. вр. ж. р. глаг. надорвАться, назвалАсь, прош. вр. ж. р. глаг. назвАться, накренИтся, 3-е л. ед. ч. глаг. накренИться, налилА, прош. вр. ж. р. глаг. налИть, нарвалА, прош. вр. ж. р. глаг. нарвАть, начАть; нАчал, началА, нАчали, прош. вр., обзвонИт, 3-е л. ед. ч. глаг. обзвонИть, облегчИть; облегчИт, 3-е л. ед. ч., облилАсь, прош. вр. ж. р. глаг. облИться, обнялАсь, прош. вр. ж. р. глаг. обнЯться, обогналА, прош. вр. ж. р. глаг. обогнАть, ободралА, прош. вр. ж. р. глаг. ободрАть, ободрИть; ободрИт, 3-е л. ед. ч., ободрИться; ободрИтся, 3-е л. ед. ч., обострИть, одолжИть; одолжИт, 3-е л. ед. ч., озлОбить, оклЕить, окружИт, 3-е л. ед. ч. глаг. окружИть, опОшлить, освЕдомиться; освЕдомится, 3-е л. ед. ч., отбылА, прош. вр. ж. р. глаг. отбЫть, отдалА, прош. вр. ж. р. глаг. отдАть, откУпорить, отозвалА, прош. вр. ж. р. глаг. отозвАть, отозвалАсь, прош. вр. ж. р. глаг. отозвАться, перезвонИт, 3-е л. ед. ч. глаг. перезвонИть, перелилА, прош. вр. ж. р. глаг. перелИть, плодоносИть, пломбировАть, повторИт, 3-е л. ед. ч. глаг. повторИть, позвалА, прош. вр. ж. р. глаг. позвАть, позвонИт, 3-е л. ед. ч. глаг. позвонИть, полилА, прош. вр. ж. р. глаг. полИть, положИть; положИл, прош. вр. м. р., понЯть; понялА, прош. вр. ж. р., послАла, прош. вр. ж. р. глаг. послАть, прибЫть; прИбыл, прибылА, прИбыли, прош. вр., принЯть; прИнял, принялА, прИняли, прош. вр., рвалА, прош. вр. ж. р. глаг. рвАть, сверлИт, 3-е л. ед. ч. глаг. сверлИть, снялА, прош. вр. ж. р. глаг. снЯть, совралА, прош. вр. ж. р. глаг. соврАть, создалА, прош. вр. ж. р. глаг. создАть, сорвалА, прош. вр. ж. р. глаг. сорвАть, сорИт, 3-е л. ед. ч. глаг. сорИть, убралА, прош. вр. ж. р. глаг. убрАть, углубИть, укрепИт, 3-е л. ед. ч. глаг. укрепИть, чЕрпать, щемИт, 3-е л. ед. ч. глаг. щемИть, щЁлкать, довезЁнный, зАгнутый, зАнятый; занятА, кр. ф. ж. р., зАпертый, заселЁнный; заселенА, кр. ф. ж. р., кормЯщий, кровоточАщий, нажИвший, налИвший, нанЯвшийся, начАвший, нАчатый, низведЁнный, облегчЁнный, ободрЁнный, обострЁнный, отключЁнный, повторЁнный, поделЁнный, понЯвший, прИнятый; принятА, кр. ф. ж. р., приручЁнный, прожИвший, снятА, кр. ф. ж. р. прич. снЯтый, сОгнутый, углублЁнный, закУпорив, начАв, начАвшись, отдАв, поднЯв, понЯв, прибЫв, создАв, вОвремя, дОверху, донЕльзя, дОнизу, дОсуха, зАсветло, зАтемно, красИвее, сравн. ст. нар. красИво, надОлго, ненадОлго"
        s = s.replaceAll(/(\.|,)/g, '')
        s = s.replaceAll(/\-/g, ' ')
        s = s.replaceAll(/\:/g, '')
        let arr = s.split(' ')
        let iter = 0
        let c = 0
        let results = []
        let lock = false
        let allright = true
        let retry = false
        let retryList = []
        let retryIndex = -1
        
        arr = arr.filter(word => word.match(/[А-Я]/g) == null ? false : true)

        let al = arr.length

        arr = shuffle(arr)

        $(document).ready(function() {
            putNewWordIntoHtml(arr[c])

            $('.charcont').click(function(e) {
                let char = null
                let currentArr = undefined

                if (retry) {
                    currentArr = retryList[retryIndex]
                } else {
                    currentArr = arr
                }

                if ($(e.target).hasClass('char')) {
                    char = $(e.target).children()
                } else if ($(e.target).parent().hasClass('char')) {
                    char = $(e.target)
                }

                if (char && !lock) {
                    c+=1

                    if (char.text().match(/[А-Я]/g) == null) {
                        results.push(char.parent()[0].dataset.num)
                        char.parent().css('backgroundColor', '#ed0f47')
                        char.parent().parent().children('.answer').css('backgroundColor', '#54f389')
                        $('.button').removeClass('invisiable')
                        lock = true
                    } else {
                        results.push(true)
                        
                        if (c >= al) {
                            pushResults()
                        } else {
                            putNewWordIntoHtml(currentArr[c])
                        }
                    }
                }
            })

            $('.button').click(function (e) {
                let currentArr = undefined

                if (retry) currentArr = retryList[retryIndex];
                else currentArr = arr;
                
                if (c >= al) pushResults();
                else putNewWordIntoHtml(currentArr[c]);
            })

            $('.retry').click(function(e) {
                retryIndex += 1
                retryList[retryIndex] = shuffle(retryList[retryIndex])
                results = []
                c = 0
                al = retryList[retryIndex].length
                allright = true

                $('.charcont, .viewer').removeClass('invisiable')
                $('.rescont, .retry').addClass('invisiable')
                $('.res').remove()

                putNewWordIntoHtml(retryList[retryIndex][c])
            })
        })

        function putNewWordIntoHtml(word) {
            let currentArr = undefined

            if (retry) {
                currentArr = retryList[retryIndex]
            } else {
                currentArr = arr
            }

            $('.viewer').text(`${c+1} of ${currentArr.length}`)
            $('.char').remove()
            $('.button').addClass('invisiable')

            lock = false

            let chararr = word.split('')
            let counter = 0

            for (let i of chararr) {
                if (i.match(/[А-Я]/g) == null) {
                    $('.charcont').append(`<div class="char" data-num="${counter}"><div>${i}</div></div>`)
                } else {
                    $('.charcont').append(`<div class="char answer"><div>${i}</div></div>`)
                }
                counter += 1
            }
        }

        function pushResults() {
            $('.charcont, .viewer, .button').addClass('invisiable')
            $('.rescont').removeClass('invisiable')
            $('.main>.rescont').append(`<div class="res">Congrats you have <span class="magenta">${Math.round(results.reduce((a, c) => c === true ? a+1 : a, 0)*100/al)}%</span></div>`)

            if (retry) {
                $('.rescont').append(`<div class="res">Try number <span class="red">${retryList.length}</span></div>`)
            }

            let counter = -1
            let subject = ''
            let currentArr = undefined

            if (retry) {
                currentArr = retryList[retryIndex]
            } else {
                currentArr = arr
            }

            retryList[retryIndex+1] = []
            retry = false

            for (let i of results) {
                counter += 1
                subject = ''

                if (i !== true) {
                    let subcounter = -1
                    let apos = currentArr[counter].search(/[А-Я]/g)
                    allright = false

                    retryList[retryIndex+1].push(currentArr[counter])

                    for (let a in currentArr[counter]) {
                        subcounter += 1
                        if (subcounter == i) {
                            subject += '<span class="red">' + currentArr[counter][i] + '</span>'
                        } else if (subcounter == apos) {
                            subject += `<span class='green'>${currentArr[counter][apos].toLocaleLowerCase()}</span>`
                        } else {
                            subject += currentArr[counter][subcounter]
                        }
                    }

                    $('.main>.rescont').append(`<div class="res">${subject}</div>`)
                }
            }

            if (!allright) {
                retry = true
                $('.retry').removeClass('invisiable')
            }
        }

        function shuffle(array) {
            let currentIndex = array.length,  randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [
                array[randomIndex], array[currentIndex]];
            }
            return array;
        }

    </script>
</body>
</html>